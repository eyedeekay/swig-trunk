top_srcdir	= @top_srcdir@
SWIG		= $(top_srcdir)/swig@release_suffix@
CC		= @CC@
CXX		= @CXX@
CFLAGS		= @CFLAGS@
GUILEINCLUDE	= @GUILEINCLUDE@
GUILELINK	= @GUILELINK@

all::   import.cplusplusruntest

.SUFFIXES: .i .test .cplusplustest .runtest .cplusplusruntest

.i.test:
	@echo Checking Examples/guile/test-suite/$<
	@$(SWIG) -guile -lguilemain.i $< || (echo "Examples/guile/test-suite/$<: SWIG FAILED "; exit 1)
	@$(CC) $(CFLAGS) $*_wrap.c -o $@-x $(GUILEINCLUDE) $(GUILELINK) || (echo "Examples/guile/test-suite/$<: COMPILE/LINK FAILED"; exit 1)
	@echo "Examples/guile/test-suite/$<: PASSED"

.i.cplusplustest:
	@echo Checking Examples/guile/test-suite/$<
	@$(SWIG) -guile -c++ -lguilemain.i $< || (echo "Examples/guile/test-suite/$<: SWIG FAILED "; exit 1)
	@$(CXX) $(CFLAGS) $*_wrap.c -o $@-x $(GUILEINCLUDE) $(GUILELINK) || (echo "Examples/guile/test-suite/$<: COMPILE/LINK FAILED"; exit 1)
	@echo "Examples/guile/test-suite/$<: PASSED"

.i.runtest:
	@echo Checking Examples/guile/test-suite/$<
	@$(SWIG) -guile -lguilemain.i $< || (echo "Examples/guile/test-suite/$<: SWIG FAILED "; exit 1)
	@$(CC) $(CFLAGS) $*_wrap.c -o $@-x $(GUILEINCLUDE) $(GUILELINK) || (echo "Examples/guile/test-suite/$<: COMPILE/LINK FAILED"; exit 1)
	@./$@-x -l $*.scm || (echo "Examples/guile/test-suite/$<: RUN TEST FAILED"; exit 1)
	@echo "Examples/guile/test-suite/$<: PASSED"

.i.cplusplusruntest:
	@echo Checking Examples/guile/test-suite/$<
	@$(SWIG) -guile -c++ -lguilemain.i $< || (echo "Examples/guile/test-suite/$<: SWIG FAILED "; exit 1)
	@$(CXX) $(CFLAGS) $*_wrap.c -o $@-x $(GUILEINCLUDE) $(GUILELINK) || (echo "Examples/guile/test-suite/$<: COMPILE/LINK FAILED"; exit 1)
	@./$@-x -l $*.scm || (echo "Examples/guile/test-suite/$<: RUN TEST FAILED"; exit 1)
	@echo "Examples/guile/test-suite/$<: PASSED"

import.cplusplusruntest:
	@echo Checking Examples/guile/test-suite/import
	@$(SWIG) -c++ -guile -Linkage passive -c import-a.i || (echo "Examples/guile/test-suite/import: SWIG FAILED "; exit 1)
	@$(SWIG) -c++ -guile -Linkage passive import-b.i  || (echo "Examples/guile/test-suite/import: SWIG FAILED "; exit 1)
	@$(CXX) $(CFLAGS) -DSWIG_GLOBAL -o import-a_wrap.o -c import-a_wrap.c $(GUILEINCLUDE)  || (echo "Examples/guile/test-suite/import: COMPILE FAILED "; exit 1)
	@$(CXX) $(CFLAGS) -DSWIG_GLOBAL -o import-b_wrap.o -c import-b_wrap.c $(GUILEINCLUDE)|| (echo "Examples/guile/test-suite/import: COMPILE FAILED "; exit 1)
	@$(CXX) $(CFLAGS) -o $@-x import-a_wrap.o import-b_wrap.o import-main.cc $(GUILEINCLUDE) $(GUILELINK)|| (echo "Examples/guile/test-suite/import: LINK FAILED "; exit 1)
	@./$@-x -l $*.scm || (echo "Examples/guile/test-suite/import: RUN TEST FAILED"; exit 1)
	@echo "Examples/guile/test-suite/import: PASSED"

clean::
	rm -f matrix *_wrap* *test-x *~ .~* core

check: all
